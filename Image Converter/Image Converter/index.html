<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Image Converter - Convert Any Image Format</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios@1.4.0/dist/axios.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.18.9/babel.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen">
  <div id="root"></div>
  <script type="text/babel">
    const { useState } = React;

    function ImageConverter() {
      const [file, setFile] = useState(null);
      const [targetFormat, setTargetFormat] = useState('');
      const [status, setStatus] = useState('');
      const [downloadUrl, setDownloadUrl] = useState('');
      const [isConverting, setIsConverting] = useState(false);

      const handleDrop = (e) => {
        e.preventDefault();
        const droppedFile = e.dataTransfer.files[0];
        if (droppedFile && droppedFile.type.startsWith('image/')) {
          setFile(droppedFile);
          setStatus(`Selected file: ${droppedFile.name}`);
          setDownloadUrl('');
        } else {
          setStatus('Please upload a valid image file.');
        }
      };

      const handleFileChange = (e) => {
        const selectedFile = e.target.files[0];
        if (selectedFile) {
          setFile(selectedFile);
          setStatus(`Selected file: ${selectedFile.name}`);
          setDownloadUrl('');
        } else {
          setStatus('Please upload a valid image file.');
        }
      };

      const handleConvert = async () => {
        if (!file || !targetFormat) {
          setStatus('Please select a file and target format.');
          return;
        }

        setIsConverting(true);
        setStatus('Converting... Please wait.');
        setDownloadUrl('');

        const formData = new FormData();
        formData.append('file', file);
        formData.append('targetFormat', targetFormat);

        try {
          const response = await axios.post('/api/convert', formData, {
            headers: { 'Content-Type': 'multipart/form-data' },
          });
          setDownloadUrl(response.data.downloadUrl);
          setStatus(`Conversion successful! File converted to ${targetFormat.toUpperCase()}.`);
        } catch (error) {
          console.error('Conversion error:', error);
          setStatus(error.response?.data || 'Conversion failed. Please try again.');
        } finally {
          setIsConverting(false);
        }
      };

      const formatCategories = {
        'Common Formats': ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp'],
        'High Quality': ['tiff', 'tif', 'pdf'],
        'Modern Formats': ['heif', 'heic', 'avif'],
        'Vector & Graphics': ['svg', 'eps', 'ai'],
        'Professional': ['psd', 'xcf', 'cdr'],
        'Camera RAW': ['raw', 'cr2', 'nef', 'arw', 'dng'],
        'Specialized': ['djvu', 'ico']
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
          {/* Header */}
          <header className="bg-blue-600 text-white shadow-lg">
            <div className="container mx-auto px-4 py-6">
              <h1 className="text-3xl font-bold text-center">ðŸŽ¨ Universal Image Converter</h1>
              <p className="text-center text-blue-100 mt-2">Convert images to any format - Professional quality, fast processing</p>
            </div>
          </header>

          {/* Main Content */}
          <main className="container mx-auto px-4 py-8">
            <div className="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-8">
              
              {/* File Upload Area */}
              <div
                className="border-2 border-dashed border-blue-300 rounded-lg p-8 text-center bg-blue-50 hover:bg-blue-100 transition-colors duration-200"
                onDrop={handleDrop}
                onDragOver={(e) => e.preventDefault()}
              >
                <div className="mb-4">
                  <svg className="mx-auto h-12 w-12 text-blue-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
                  </svg>
                </div>
                <p className="text-lg font-medium text-gray-700 mb-2">Drop your image here or click to browse</p>
                <p className="text-sm text-gray-500 mb-4">Supports all major image formats including RAW, PSD, AI, and more</p>
                <input
                  type="file"
                  onChange={handleFileChange}
                  accept="image/*,.psd,.ai,.cdr,.xcf,.raw,.cr2,.nef,.arw,.dng,.djvu"
                  className="hidden"
                  id="fileInput"
                />
                <label
                  htmlFor="fileInput"
                  className="inline-block bg-blue-600 text-white px-6 py-2 rounded-lg cursor-pointer hover:bg-blue-700 transition-colors"
                >
                  Choose File
                </label>
              </div>

              {/* Selected File Info */}
              {file && (
                <div className="mt-6 p-4 bg-green-50 border border-green-200 rounded-lg">
                  <div className="flex items-center">
                    <svg className="h-5 w-5 text-green-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                      <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                    </svg>
                    <span className="text-green-800 font-medium">Selected: {file.name}</span>
                    <span className="ml-2 text-green-600 text-sm">({(file.size / 1024 / 1024).toFixed(2)} MB)</span>
                  </div>
                </div>
              )}

              {/* Format Selection */}
              <div className="mt-6">
                <label className="block text-sm font-medium text-gray-700 mb-3">Select Target Format:</label>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  {Object.entries(formatCategories).map(([category, formats]) => (
                    <div key={category} className="border border-gray-200 rounded-lg p-4">
                      <h3 className="font-semibold text-gray-800 mb-2 text-sm">{category}</h3>
                      <div className="grid grid-cols-3 gap-2">
                        {formats.map(format => (
                          <button
                            key={format}
                            onClick={() => setTargetFormat(format)}
                            className={`px-3 py-2 text-xs rounded transition-colors ${
                              targetFormat === format
                                ? 'bg-blue-600 text-white'
                                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                            }`}
                          >
                            {format.toUpperCase()}
                          </button>
                        ))}
                      </div>
                    </div>
                  ))}
                </div>
              </div>

              {/* Convert Button */}
              <div className="mt-8 text-center">
                <button
                  onClick={handleConvert}
                  disabled={!file || !targetFormat || isConverting}
                  className={`px-8 py-3 rounded-lg font-semibold transition-all duration-200 ${
                    !file || !targetFormat || isConverting
                      ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                      : 'bg-blue-600 text-white hover:bg-blue-700 transform hover:scale-105 shadow-lg'
                  }`}
                >
                  {isConverting ? (
                    <div className="flex items-center">
                      <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" fill="none" viewBox="0 0 24 24">
                        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                      </svg>
                      Converting...
                    </div>
                  ) : (
                    `Convert to ${targetFormat ? targetFormat.toUpperCase() : 'Format'}`
                  )}
                </button>
              </div>

              {/* Status Message */}
              {status && (
                <div className={`mt-6 p-4 rounded-lg ${
                  status.includes('successful') || status.includes('Selected')
                    ? 'bg-green-50 border border-green-200 text-green-800'
                    : status.includes('failed') || status.includes('Please')
                    ? 'bg-red-50 border border-red-200 text-red-800'
                    : 'bg-blue-50 border border-blue-200 text-blue-800'
                }`}>
                  <p className="text-center font-medium">{status}</p>
                </div>
              )}

              {/* Download Button */}
              {downloadUrl && (
                <div className="mt-6 text-center">
                  <a
                    href={downloadUrl}
                    download
                    className="inline-flex items-center px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors shadow-lg"
                  >
                    <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    Download Converted File
                  </a>
                </div>
              )}
            </div>

            {/* Features Section */}
            <div className="mt-12 grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl mx-auto">
              <div className="bg-white rounded-lg shadow p-6 text-center">
                <div className="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-4">
                  <svg className="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                  </svg>
                </div>
                <h3 className="font-semibold text-gray-800 mb-2">Lightning Fast</h3>
                <p className="text-gray-600 text-sm">High-performance conversion powered by ImageMagick</p>
              </div>
              <div className="bg-white rounded-lg shadow p-6 text-center">
                <div className="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mx-auto mb-4">
                  <svg className="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </div>
                <h3 className="font-semibold text-gray-800 mb-2">25+ Formats</h3>
                <p className="text-gray-600 text-sm">Support for all major formats including RAW, PSD, AI</p>
              </div>
              <div className="bg-white rounded-lg shadow p-6 text-center">
                <div className="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mx-auto mb-4">
                  <svg className="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                  </svg>
                </div>
                <h3 className="font-semibold text-gray-800 mb-2">Secure & Private</h3>
                <p className="text-gray-600 text-sm">Files are automatically deleted after 2 hours</p>
              </div>
            </div>
          </main>

          {/* Footer */}
          <footer className="bg-gray-800 text-white py-8 mt-16">
            <div className="container mx-auto px-4 text-center">
              <p className="text-gray-300">&copy; 2025 Universal Image Converter. All rights reserved.</p>
              <p className="text-gray-400 text-sm mt-2">Built with React, Express, and ImageMagick</p>
            </div>
          </footer>
        </div>
      );
    }

    ReactDOM.render(<ImageConverter />, document.getElementById('root'));
  </script>
</body>
</html>
